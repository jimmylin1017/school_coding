/\(\([a-z]\)[^a-z]*[a-z]\?@[^a-z]*\2\)\([^\n]*\)/!d
s//@\3\n\1/
b B

:A
G

:B
h
/\(\([a-z]\)[^a-z]*[a-z]\?@[^a-z]*\2\)/ s/\n[^\n]*@[^\n]*//g

x

/\(\([a-z]\)[^a-z]*[a-z]\?@[^a-z]*\2\)/ s/[^\n]*\n//

t C
:C

/\(\([a-z]\)[^a-z]*[a-z]\?@[^a-z]*\2\)/ s/\([^\n]*\)@\([^\n]*\)\n\([^\n]*\)@\([^\n]*\)/\1\3@\4\2/
x
s/\(\([a-z]\)[^a-z]*@[^a-z]*\2\)\([^\n]*\)/@\3\n\1/
t A
x
s/@//